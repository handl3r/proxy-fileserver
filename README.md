# Proxy file server
Proxy file server integrate with Google Drive for cache file with high frequency download

# Instruction Build and Run
Requirement: Git, golang(version > 1.12), windows or linux os, openssl
## 1. Generate key pair rsa
* Command
```shell script
openssl genrsa -out private.pem 512
openssl rsa -in private.pem -outform PEM -pubout -out public.pem
```
* Output:
    * private.pem is secret key use for your website to generate token 
    * public.pem is key use for proxy for validating token purpose

## 2. Build
- In your project folder :
```shell script
git clone https://github.com/handl3r/proxy-fileserver
cd proxy-fileserver
```
```shell script
# in windows
go build -o proxy-fileserver.exe cmd/main.go 
# or in linux
go build -o proxy-fileserver cmd/main.go
```
- Fix .env file with your config:
    * PROXY_SERVER_ENV= dev or prod, prod will come with log in json format
    * SHARED_ROOT_FOLDER_LOCAL= parent folder of shared-folder on server
    * SHARED_ROOT_FOLDER= shared-folder name your shared folder on Google Drive, same name with mirror folder on server
    * SHARED_ROOT_FOLDER_ID= your shared folder id on Google Drive, example: 1eQ-6Ftg1G1ewA_-7puGpV_YCjHkpmkVe
    * CACHE_TIME_LOCAL_FILE_SYSTEM= unit minute, time to delete a cached file on server from last download time
    * AUTH_PUBLIC_KEY= path to your public key that generated by openssl, example certificates/public512.pem      
    * CYCLE_TIME_CLEANER= unit minute, cycle time cleaner wake up to clean expired files  
    * MYSQL_USER= username database
    * MYSQL_PASSWORD=  password database
    * MYSQL_PORT=3306 port database mysql
    * MYSQL_HOST= host database
    * MYSQL_DATABASE= name database
    * GOOGLE_APPLICATION_CREDENTIALS= path to credential file (json) of service account cloud google
  
- .env and binary file must be in the same folder

## 3. Setup
* On Cloud Google:
  * Create service account and get certificate in json file (1)
  * Enable Drive api
  
* On Google Drive:
  * Files storage in 'shared-folder'
  * Share your 'shared-folder' with service account of google cloud
  * Get ID of 'shared-folder' on url
  
* On server:
  * Create parent folder: example 'temp'
  * Create 'shared-folder' inside 'temp'
  * Put your public key and certificate from (1) on somewhere: example 'certificates/cer.json', 'certificates/public512.pem'
  * Define your .env file




